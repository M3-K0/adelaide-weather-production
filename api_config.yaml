# Adelaide Weather API - Comprehensive Configuration
# Generated: 2025-11-11
# Status: CNN Model Dimension Mismatch RESOLVED

# API Information
api:
  name: "Adelaide Weather Forecasting API"
  version: "1.0.0"
  description: "Real-time weather forecasting using FAISS-based analog ensemble method"
  contact:
    name: "Adelaide Weather Team"
    email: "support@adelaide-weather.com"
    url: "https://adelaide-weather.com"

# Environment Settings
environment:
  name: "production"
  debug: false
  testing: false
  log_level: "INFO"
  
# Neural Network Configuration
model:
  # CRITICAL: CNN model expects exactly 11 input channels
  input_channels: 11
  output_dimension: 256
  normalization: true
  device: "cuda"
  checkpoint_path: "outputs/training_production_demo/best_model.pt"
  config_path: "configs/model.yaml"
  
  # Weather Variables (in exact training order)
  input_variables:
    - name: "t2m"
      description: "2m temperature"
      units: "K"
      level: "surface"
      order: 1
    - name: "msl"
      description: "Mean sea level pressure"
      units: "Pa"
      level: "surface"
      order: 2
    - name: "u10"
      description: "10m u-component of wind"
      units: "m/s"
      level: "surface"
      order: 3
    - name: "v10"
      description: "10m v-component of wind"
      units: "m/s"
      level: "surface"
      order: 4
    - name: "tp"
      description: "Total precipitation"
      units: "m"
      level: "surface"
      order: 5
    - name: "z500"
      description: "Geopotential at 500mb"
      units: "m"
      level: 500
      order: 6
    - name: "t500"
      description: "Temperature at 500mb"
      units: "K"
      level: 500
      order: 7
    - name: "u500"
      description: "U-component of wind at 500mb"
      units: "m/s"
      level: 500
      order: 8
    - name: "v500"
      description: "V-component of wind at 500mb"
      units: "m/s"
      level: 500
      order: 9
    - name: "z850"
      description: "Geopotential at 850mb"
      units: "m"
      level: 850
      order: 10
    - name: "t850"
      description: "Temperature at 850mb"
      units: "K"
      level: 850
      order: 11

# FAISS Configuration
faiss:
  embeddings_dir: "embeddings"
  indices_dir: "indices"
  outcomes_dir: "outcomes"
  
  # Index Configuration
  index_type: "flatip"
  use_optimized: true
  search_k: 50
  
  # Supported Horizons
  horizons:
    - name: "6h"
      vectors: 6574
      dimension: 256
    - name: "12h"
      vectors: 6574
      dimension: 256
    - name: "24h"
      vectors: 13148
      dimension: 256
    - name: "48h"
      vectors: 13148
      dimension: 256

# Performance Configuration
performance:
  max_workers: 4
  pool_size: 2
  search_timeout_ms: 5000
  pool_timeout_ms: 1000
  retry_attempts: 2
  max_memory_mb: 2048
  gc_threshold: 100

# Health Monitoring
health:
  monitoring_enabled: true
  check_interval_seconds: 60
  faiss_health_monitoring: true
  performance_tracking: true
  metrics_collection: true
  alert_threshold: 0.8

# Security Configuration
security:
  cors:
    enabled: true
    origins:
      - "https://adelaide-weather.com"
      - "https://api.adelaide-weather.com"
      - "https://localhost:3000"
  
  rate_limiting:
    enabled: true
    requests_per_minute: 100
    burst_limit: 20
    
  authentication:
    api_key_required: true
    token_validation: true

# Data Sources
data_sources:
  weather_api:
    key: "8fb71420c6364a98919121035252410"
    base_url: "http://api.weatherapi.com/v1"
    timeout_seconds: 30
    
  era5:
    enabled: false
    data_path: "/data/era5"
    fallback_to_mock: true
    
  gfs:
    enabled: false
    data_path: "/data/gfs"

# API Endpoints Configuration
endpoints:
  forecast:
    path: "/forecast"
    methods: ["GET", "POST"]
    cache_ttl_seconds: 300
    
  health:
    path: "/health"
    methods: ["GET"]
    public: true
    
  metrics:
    path: "/metrics"
    methods: ["GET"]
    auth_required: true

# Cache Configuration
cache:
  type: "redis"
  ttl_seconds: 300
  max_size: 1000
  redis_url: "redis://localhost:6379/0"

# Database Configuration
database:
  type: "postgresql"
  url: "postgresql://localhost:5432/adelaide_weather"
  connection_pool_size: 5
  connection_timeout: 30

# Logging Configuration
logging:
  level: "INFO"
  format: "structured"
  output: "file"
  file_path: "/var/log/adelaide-weather/api.log"
  rotation: "daily"
  retention_days: 30

# Monitoring and Observability
monitoring:
  prometheus:
    enabled: true
    port: 9090
    path: "/metrics"
    
  grafana:
    enabled: true
    dashboard_config: "monitoring/grafana/dashboards/"
    
  alerting:
    email: "ops@adelaide-weather.com"
    channels: ["email", "slack"]

# Feature Flags
features:
  real_time_forecasting: true
  analog_search: true
  mock_data_fallback: false
  faiss_health_monitoring: true
  performance_optimization: true
  advanced_caching: true

# Quality Assurance
quality:
  validation_enabled: true
  confidence_threshold: 0.8
  alert_on_failure: true
  automatic_fallback: false

# Backup and Recovery
backup:
  enabled: true
  interval_hours: 24
  retention_days: 30
  location: "s3://adelaide-weather-backups/"
  
# Cloud Configuration
cloud:
  provider: "aws"
  region: "ap-southeast-2"
  storage:
    bucket: "adelaide-weather-data"
    prefix: "production/"

# Critical Fix Documentation
fix_applied:
  date: "2025-11-11"
  issue: "CNN model dimension mismatch"
  problem: "Model expected 11 input channels but received 9"
  solution: "Updated _extract_weather_pattern() method in analog_forecaster.py"
  details:
    - "Added missing surface variables: t2m, u10, v10, tp"
    - "Removed excess variables: u850, v850"
    - "Reordered variables to match training sequence"
    - "Changed output shape from (21,21,9) to (21,21,11)"
  status: "RESOLVED"
  verification: "Real FAISS analog forecasting operational"
  mock_data_usage: "0%"

# API Variable Mappings
variable_mappings:
  supported_output_variables:
    - "t2m"        # 2m temperature
    - "u10"        # 10m u-wind
    - "v10"        # 10m v-wind
    - "cape"       # Convective Available Potential Energy
    - "t850"       # Temperature at 850mb
    - "z500"       # Geopotential at 500mb
    - "r850"       # Relative humidity at 850mb
    - "msl"        # Mean sea level pressure
    - "tp6h"       # 6-hour precipitation
    
  direct_mappings: 7
  computed_variables: 2
  
# System Status
system_status:
  overall: "OPERATIONAL"
  model_status: "LOADED"
  faiss_indices: "AVAILABLE"
  analog_search: "ACTIVE"
  mock_data_fallback: "DISABLED"
  last_verification: "2025-11-11T14:39:18+00:00"